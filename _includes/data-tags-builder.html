{%- assign tags = post.tags | join: ',' | downcase | replace: '_', ' ' | escape -%}

{%- assign post_date = post.date | date: '%Y-%m-%d' -%}
{%- assign now = 'now' | date: '%Y-%m-%d' -%}
{%- assign now_day = 'now' | date: '%u' | plus: 0 -%}
{%- assign post_day = post.date | date: '%u' | plus: 0 -%}
{%- assign now_week = 'now' | date: '%U' | plus: 0 -%}
{%- assign post_week = post.date | date: '%U' | plus: 0 -%}
{%- assign now_year = 'now' | date: '%Y' | plus: 0 -%}
{%- assign post_year = post.date | date: '%Y' | plus: 0 -%}
{%- assign now_month = 'now' | date: '%m' | plus: 0 -%}
{%- assign post_month = post.date | date: '%m' | plus: 0 -%}

{%- assign date_tags = '' | split: '' -%}
{%- if post_date == now -%}
  {%- assign date_tags = date_tags | push: 'today' -%}
{%- endif -%}
{%- assign yesterday = 'now' | date: '%s' | minus: 86400 | date: '%Y-%m-%d' -%}
{%- if post_date == yesterday -%}
  {%- assign date_tags = date_tags | push: 'yesterday' -%}
{%- endif -%}
{%- if post_year == now_year and post_week == now_week -%}
  {%- assign date_tags = date_tags | push: 'this_week' -%}
{%- endif -%}
{%- assign last_week = now_week | minus: 1 -%}
{%- if post_year == now_year and post_week == last_week -%}
  {%- assign date_tags = date_tags | push: 'last_week' -%}
{%- endif -%}
{%- if post_year == now_year and post_month == now_month -%}
  {%- assign date_tags = date_tags | push: 'this_month' -%}
{%- endif -%}
{%- assign last_month = now_month | minus: 1 -%}
{%- assign last_month_year = now_year -%}
{%- if last_month == 0 -%}
  {%- assign last_month = 12 -%}
  {%- assign last_month_year = now_year | minus: 1 -%}
{%- endif -%}
{%- if post_year == last_month_year and post_month == last_month -%}
  {%- assign date_tags = date_tags | push: 'last_month' -%}
{%- endif -%}
{%- if post_year == now_year -%}
  {%- assign date_tags = date_tags | push: 'this_year' -%}
{%- endif -%}
{%- assign last_year = now_year | minus: 1 -%}
{%- if post_year == last_year -%}
  {%- assign date_tags = date_tags | push: 'last_year' -%}
{%- endif -%}

{%- assign all_tags = tags | append: ',' | append: date_tags | join: ',' | replace: ',,', ',' | replace: '__', '_' | replace: ',,', ',' | replace: '_', ' ' | escape -%}
